---
layout: post
date: 2024-08-18
title: "[SystemDesign-Facebook Newsfeed] Database sharding"
tags: [System Design, Architecture, Facebook Newsfeed, ]
categories: [System Design, Problems, Facebook Newsfeed, ]
---


### **1. 게시물 및 메타데이터 샤딩 (Sharding)**

- **문제:** 매일 엄청난 양의 새로운 게시물이 생성되며, 이로 인해 데이터베이스에 대한 읽기 및 쓰기 부하가 매우 높다.
- **해결 방법:** 데이터를 여러 서버에 분산시켜 효율적으로 관리하기 위해, 데이터베이스를 샤딩한다. 이 과정에서 **`epoch time`****을 게시물의 Primary Key로 사용**하고, 이를 기준으로 데이터를 샤딩한다.
	- **샤딩 방식:** `epoch time`을 기준으로 게시물과 메타데이터를 시간순으로 여러 서버에 분산 저장한다. 이 방식은 특정 시간대에 생성된 데이터가 균등하게 분산되도록 한다.
	- **장점:** 시간대별로 데이터가 분산되어 서버에 걸리는 부하를 줄이고, 특히 최근 게시물에 대한 빠른 접근이 가능하다.

#### **2. 피드 데이터 샤딩 (Sharding)**

- **문제:** 피드 데이터를 메모리에 저장할 때, 이 데이터를 효율적으로 관리하고 빠르게 접근할 수 있는 방법이 필요하다.
- **해결 방법:** `UserID`를 기준으로 데이터를 파티셔닝(분할)하여 사용자별로 피드 데이터를 한 서버에 저장한다.
	- **캐싱 방식:** 데이터를 저장할 때 `UserID`를 해시 함수에 전달하여, 해당 사용자를 특정 캐시 서버에 매핑. 사용자의 모든 피드 데이터를 해당 서버에 저장한다.
	- **특정 사용자에 대한 처리:** 일반적으로 500개의 `FeedItemID`를 초과해서 저장할 필요가 없으므로, 한 사용자의 피드 데이터는 하나의 서버에 충분히 저장 가능하다.
	- **데이터 접근:** 사용자의 피드를 조회할 때는 항상 하나의 서버에만 쿼리하면 됨, 따라서 데이터 접근이 단순하고 빠르다.
	- **향후 확장성:** 시스템이 확장되거나 복제될 때, 일관된 해싱(Consistent Hashing)을 사용하여 데이터를 효율적으로 분산시킨다.
