---
layout: post
date: 2024-08-15
title: "[SystemDesign-Rate Limiter] Rate Limiter 알고리즘"
tags: [System Design, Architecture, Late Limiter, ]
categories: [System Design, Problems, Late Limiter, ]
---


### 1. 알고리즘 종류

1. **Fixed Window 알고리즘**

고정된 시간 창(window) 내에서 요청을 계산한다. 예를 들어 1분마다 요청 수를 계산하여 이 시간 창 내에서 허용된 요청 수를 초과하면 추가 요청을 차단한다. 


장점 : 구현이 간단하고 계산이 용이


단점 : 윈도우가 리셋될 때 근처에 요청이 집중되는 ‘burst’ 문제가 발생


예시 : UserID `12345`가 13:00:00 ~ 13:00:59 동안 100개의 요청을 보냈다면, 13:01:00 이전에 추가 요청이 들어오면 모두 거부

1. **Sliding Window 알고리즘**

요청을 연속적인 시간 간격으로 계산한다. 일반적으로 초 단위 또는 분 단위로 계산된 요청 수를 제공하여 실시간으로 요청을 제한한다. 


장점 : 고정 윈도우에 비해 더 균일한 요청 제한을 제공하며, ‘burst’문제를 줄일 수 있다.


단점 : 구현이 복잡하고 정확한 시간 간격 계산이 필요


예시 : UserID `12345`가 13:00:30에 50개의 요청을, 13:01:00에 50개의 요청을 보냈다면, 13:01:30까지는 추가 요청이 거부된다. 하지만 13:01:30이 지나면 13:00:30에 보낸 요청이 유효 시간에서 벗어나므로 추가 요청이 허용된다.

1. **Token Bucket 알고리즘**

버킷에 토큰을 일정한 속도로 추가하고 각 요청은 버킷에서 하나의 토큰을 소비한다. 버킷에 토큰이 없는 경우 요청이 제한된다. 


장점 : ‘burst’ 트래픽을 자연스럽게 처리할 수 있으며 요청의 간헐적 증가에 유연하게 대응가능


단점 : 구현이 상대적으로 복잡하고 토큰의 추가 및 소모를 정확히 관리 필요


예시 : UserID `12345`가 10초 동안 요청을 하지 않다가, 10초 후에 15개의 요청을 보낸다면, 초기 10개의 토큰과 10초 동안 추가된 10개의 토큰이 있어, 총 20개의 요청 중 15개는 즉시 처리되고, 나머지 5개의 토큰이 남게 된다. 이후 1초마다 5개의 요청이 추가로 가능해진다.

1. **Leaky Bucket 알고리즘**

요청이 버킷에 추가되며 버킷은 일정한 속도로 물이 새는 것처럼 일정하게 요청을 처리한다. 버킷이 가득차면 추가적인 요청은 버려진다. 


장점 : 트래픽이 고르게 분배되도록 하여 과도한 ‘burst’ 방지


단점 : 요청의 연속적인 폭등을 잘 처리하지 못함 


예시 : **예시**: UserID `12345`가 갑자기 20개의 요청을 보냈다면, 첫 번째 5개의 요청만 즉시 처리되고, 나머지는 초당 5개의 속도로 순차적으로 처리된다. 만약 그 사이에 추가 요청이 발생하면, 버킷이 넘쳐서 일부 요청은 버려질 수 있다.

1. **Concurrent Limiting**

특정한 시간에 동시에 처리할 수 있는 요청의 수를 제한한다. 주로 API 서버에서 과부하를 방지하기 위해 사용되며 현재 활성 요청 수가 설정한 한도를 초과하면 새로운 요청을 거부하거나 대기열에 넣는다. 


장점 : 서버의 안정성을 높이고 과도한 부하를 방지 


단점 : 대기 시간이 길어질 수 있으며 잘못된 설정 시 시스템이 예상보다 더 느리게 동작할 수 있음


예시 : UserID `12345`가 10개의 요청을 동시에 보냈다면, 처음 5개는 처리되고, 나머지 5개는 대기한다. 이 후 처리 중이던 요청이 완료되면, 대기 중이던 요청이 처리된다.


#### 2. 알고리즘에 따른 Throttling 종류

1. Hard Throttling
- 설정된 한도를 초과하는 모든 요청을 즉시 거부한다.
- Fixed Window, Sliding Window, Token Bucket 등 알리즘에 적용
- 유연성이 없고 엄격하며 한도를 초과하는 요청은 무조건 거부
1. Soft Throttling
- 요청이 한도에 도달하더라도 일정 수준의 유연성을 허용하여 요청을 대기열에 추가하거나 우선순위에 따라 처리할 수 있다. 예를 들어 1분동안 100개의 메세지가 한도로 정해질 경우 Rate Limiter가 110개의 메세지까지는 허용하도록 한다.
- Token Bucket이나 Sliding Window와 함께 사용
1. Elastic or Dynamic Throttling
- 시스템의 상태나 사용자의 행동에 따라 요청 한도를 동적으로 조정하는 속도 제한 기법이다. 예를 들어 1분동안 100개의 메세지 요청이 가능할 경우 시스템의 리소스 사용 상태에 따라 100개 이상의 요청을 처리할 수 있다.
- Token Bucket, Sliding Window 알고리즘과 함께 사용하는 경우가 많음
