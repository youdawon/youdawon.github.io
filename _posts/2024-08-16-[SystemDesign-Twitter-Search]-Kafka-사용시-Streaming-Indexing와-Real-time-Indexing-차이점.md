---
layout: post
date: 2024-08-16
title: "[SystemDesign-Twitter Search] Kafka 사용시 Streaming Indexing와 Real-time Indexing 차이점"
tags: [SystemDesign, Architecture, Kafka, ]
categories: [SystemDesign, Problems, Twitter Search, ]
---


### **실시간 인덱싱(Real-time Indexing)**


**개념**:

- 실시간 인덱싱은 데이터가 생성되자마자 이를 즉시 검색 엔진에 반영하는 방식이다. 데이터의 최신성을 보장하여 사용자가 실시간으로 최신 데이터를 검색할 수 있도록 하는 것이 목표이다.

**특징**:

- **데이터 흐름**: 데이터가 생성되면 이를 바로 인덱싱 시스템으로 전송하여 즉시 처리한다.
- **파티션 사용 여부**: 시스템 요구사항에 따라 파티션을 사용할 수도 있고, 사용하지 않을 수도 있다. 작은 데이터 세트나 단순한 작업에서는 파티션 없이 순차적으로 처리할 수 있다.
- **단일 대상**: 실시간 인덱싱은 보통 하나의 검색 엔진(예: Elasticsearch)에 데이터를 전송하여 인덱싱한다.
- **오프셋 관리**: 컨슈머는 Kafka 토픽에서 데이터를 읽을 때, **오프셋**을 사용하여 현재 읽고 있는 메시지의 위치를 추적한다. 오프셋을 커밋(Commit)함으로써 메시지 처리 상태를 기록하고, 이후 메시지를 연속적으로 처리할 수 있다.
- **처리 방식**: 컨슈머가 데이터를 하나씩 순차적으로 처리하며, 메시지를 받자마자 인덱싱 작업을 수행한다.

**예시**:

- 뉴스 웹사이트에서 새로운 기사가 게시될 때, 이 기사를 즉시 검색 엔진에 반영하여 사용자가 실시간으로 검색할 수 있게 하는 경우. 이때, 오프셋을 사용하여 각 기사가 정확한 순서로 처리된다.

---


#### **스트리밍 인덱싱(Streaming Indexing)**


**개념**:

- 스트리밍 인덱싱은 대규모 데이터 스트림을 실시간으로 처리하고, 여러 시스템에 데이터를 동시에 전송하여 다양한 작업(예: 인덱싱, 실시간 분석, 저장)을 수행하는 방식이다.

**특징**:

- **데이터 흐름**: 대규모 데이터가 지속적으로 발생하고, 이 데이터가 실시간으로 처리됩니다. Kafka와 같은 스트리밍 플랫폼을 통해 데이터가 전송된다.
- **파티션 사용**: 스트리밍 인덱싱은 주로 파티션을 사용하여 데이터를 병렬로 처리한다. 각 파티션은 별도의 컨슈머에게 할당되며, 병렬 처리를 통해 성능을 최적화한다.
- **다중 대상**: 스트리밍 인덱싱은 여러 시스템(예: 검색 엔진, 실시간 분석 엔진, 데이터 저장소)에 데이터를 동시에 전송할 수 있다.
- **오프셋 관리**: 스트리밍 인덱싱에서도 **오프셋**은 각 파티션에서 메시지의 위치를 추적하는 데 사용된다. 각 컨슈머는 할당된 파티션에서 오프셋을 관리하며, 병렬 처리와 함께 메시지의 정확한 순서와 처리를 보장한다.
- **처리 방식**: 각 파티션의 메시지는 컨슈머에 의해 하나씩 처리되지만, 전체적으로 병렬로 데이터를 처리하여 높은 처리량을 달성한다.

**예시**:

- 트위터에서 생성된 트윗 데이터를 실시간으로 수집하여, 이를 검색 엔진에 인덱싱하고, 동시에 실시간 분석 시스템에서 트렌드를 분석하며, 장기 보관을 위해 데이터베이스에 저장하는 경우. 오프셋을 사용하여 각 트윗이 정확한 순서로 처리된다.

---


#### **주요 차이점 요약**


| 특징         | 실시간 인덱싱                 | 스트리밍 인덱싱                     |
| ---------- | ----------------------- | ---------------------------- |
| **데이터 처리** | 실시간으로 데이터를 즉시 처리        | 실시간으로 데이터를 병렬 처리             |
| **파티션 사용** | 필요에 따라 사용 (작업에 따라 다름)   | 주로 사용하여 데이터를 병렬로 처리          |
| **오프셋 관리** | 컨슈머가 메시지를 처리할 때 오프셋을 관리 | 각 파티션에서 컨슈머가 오프셋을 관리하며 병렬 처리 |
| **메시지 전달** | 일반적으로 하나의 시스템에 전달       | 여러 시스템에 동시에 전달 가능            |
| **적용 범위**  | 단일 작업 또는 작은 규모의 시스템에 적합 | 대규모 데이터 처리, 여러 시스템 통합에 적합    |
| **데이터 흐름** | 순차적 데이터 처리              | 병렬 데이터 처리                    |


---


#### **오프셋(Offset) 관리**

- **오프셋(Offset)**은 Kafka에서 각 메시지의 위치를 나타내는 숫자로, **컨슈머가 메시지를 처리하는 위치를 추적**하는 데 사용된다. 오프셋 관리가 잘 이루어지면, 데이터가 정확한 순서대로 처리되고, 시스템 장애가 발생해도 메시지 손실 없이 다시 처리할 수 있다.

**오프셋의 주요 역할**:

- **순차적 처리 보장**: 컨슈머는 오프셋을 통해 메시지를 순서대로 처리하며, 처리된 메시지의 위치를 기록한다.
- **데이터 정확성 유지**: 오프셋을 커밋함으로써, 메시지가 정확하게 처리되었음을 확인하고, 중복 처리를 방지할 수 있다.
- **장애 복구**: 시스템 장애가 발생했을 때, 마지막 커밋된 오프셋 이후부터 메시지 처리를 재개할 수 있다.
