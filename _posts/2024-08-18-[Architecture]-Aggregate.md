---
layout: post
date: 2024-08-18
title: "[Architecture] Aggregate"
tags: [Architecture, Domain Driven Design, DDD, Aggregate, ]
categories: [Architecture, ]
---

- **애그리게잇(Aggregate)**은 **도메인 주도 설계(DDD)**에서 도메인 모델의 일관성을 유지하고 트랜잭션 경계를 정의하는 중요한 개념이다. 애그리게잇은 관련된 엔티티(Entity)와 값 객체(Value Object)를 하나의 논리적 단위로 묶어, 이 단위 내에서 모든 상태 변화가 일관성 있게 처리되도록 보장한다.

#### 애그리게잇의 주요 개념


#### 1. **경계(Boundary)와 트랜잭션 경계**

- **경계**: 애그리게잇은 여러 객체(엔티티와 값 객체)를 포함하는 경계를 정의한다. 이 경계 내에서 이루어지는 모든 상태 변화는 하나의 일관된 단위로서 동작한다.
- **트랜잭션 경계**: 애그리게잇은 하나의 트랜잭션 경계를 정의한다. 하나의 애그리게잇에서 발생하는 모든 변경 사항은 하나의 트랜잭션으로 처리되어야 하며, 트랜잭션이 완료되지 않으면 애그리게잇 내부의 상태 변화는 외부에 반영되지 않는다.

#### 2. **애그리게잇 루트(Aggregate Root)**

- **정의**: 애그리게잇 루트는 애그리게잇의 핵심 엔티티로, 애그리게잇 내부의 상태와 객체에 접근하는 유일한 진입점이다. 외부에서는 애그리게잇 루트를 통해서만 애그리게잇 내부의 다른 엔티티나 값 객체에 접근할 수 있다.
- **역할**: 애그리게잇 루트는 애그리게잇 내부 객체들 간의 일관성을 책임지며, 모든 변경 작업은 애그리게잇 루트를 통해 이루어진다.

#### 3. **일관성(Consistency)**

- 애그리게잇은 내부 상태의 일관성을 유지해야 한다. 애그리게잇 내부의 엔티티나 값 객체 간의 상태가 상호 일관성 있게 유지되며, 하나의 트랜잭션 안에서 애그리게잇의 모든 변경이 완료되어야 한다.

#### 4. **외부와의 관계**

- 애그리게잇은 다른 애그리게잇이나 외부 객체와의 관계가 매우 느슨하게 설계된다. 직접적인 참조 대신, **식별자**(ID)만을 통해 참조할 수 있다. 이는 애그리게잇의 독립성을 보장하고, 일관성을 유지하는 데 도움을 준다.

#### 애그리게잇의 예시

1. **전자상거래 예시: 주문 애그리게잇**
	- **애그리게잇 루트**: 주문(Order) 엔티티.
	- **애그리게잇 경계**: 주문 항목(Order Line), 배송 정보(Shipping Info)와 같은 관련된 엔티티와 값 객체들.
	- **트랜잭션 단위**: 주문을 생성하거나 수정할 때, 주문 애그리게잇 내부의 모든 객체들이 일관성 있게 처리된다.
2. **은행 시스템 예시: 계좌 애그리게잇**
	- **애그리게잇 루트**: 계좌(Account) 엔티티.
	- **애그리게잇 경계**: 거래 기록(Transaction), 잔액(Balance)과 같은 관련된 엔티티와 값 객체들.
	- **트랜잭션 단위**: 계좌에서 발생하는 모든 입출금 거래는 하나의 트랜잭션 내에서 처리되어야 하며, 이 과정에서 계좌의 잔액과 거래 기록이 일관성 있게 업데이트된다.

#### 애그리게잇의 사용 이유

1. **도메인 복잡성 관리**
	- 복잡한 도메인 로직을 처리할 때, 애그리게잇은 관련된 엔티티와 값 객체를 하나의 논리적 단위로 묶어 복잡성을 줄인다. 이를 통해 비즈니스 로직이 분산되지 않고, 한 곳에서 관리될 수 있다.
2. **일관성 유지**
	- 시스템의 데이터 일관성을 보장하기 위해, 애그리게잇은 내부 객체 간의 일관성을 책임진다. 하나의 애그리게잇에서 발생하는 모든 변화는 일관된 상태로 처리되며, 이를 통해 시스템의 무결성을 유지할 수 있다.
3. **서비스 간 결합 최소화**
	- 애그리게잇은 외부 객체나 다른 애그리게잇과의 강한 결합을 피하며, ID를 통해 간접적으로 참조하게 한다. 이를 통해 도메인 객체 간의 결합을 느슨하게 만들어 시스템이 더 유연해지고 확장 가능해진다.
