---
layout: post
date: 2024-08-10, 5:40:00 am
title: "[SystemDesign-Twritter] System flows"
tags: [SystemDesign, Architecture, Twitter, ]
categories: [SystemDesign, Problems, Twitter, ]
---


### 1. User Interaction

- **User Requests**: Users interact with your application through a Load Balancer and API Gateway. This setup routes user requests, such as creating tweets, uploading files, or searching for tweets, to the appropriate services in the backend.

#### **2. Tweet Creation**

- **Generating** **`tweet_id`**: When a user creates a tweet, the system generates a unique `tweet_id` by combining the current epoch time with an auto-incrementing sequence. This `tweet_id` is crucial for ensuring each tweet is uniquely identifiable and chronologically ordered.
- **Sharding and Storage**: The `tweet_id` determines which shard in the NoSQL database the tweet will be stored in. This sharding mechanism distributes the load across multiple database partitions, enhancing scalability and performance. The NoSQL database is partitioned by `tweet_id`, and data is replicated to read-only replicas to ensure high availability and fault tolerance.

#### **3. File Handling**

- **Direct Uploads**: Users can upload files, such as images or videos, directly to Amazon S3 using presigned URLs generated by the system. This offloads the file handling from your servers, reducing load and improving performance.
- **Metadata Management**: The metadata for these files is managed by the File Services and stored in the SQL database. The SQL database is partitioned by user ID and replicated to read-only replicas to handle high read traffic.

#### **4. Caching**

- **Cache Servers**: Cache servers are used to store frequently accessed data, such as user metadata and hot/top tweets. This reduces the load on your databases and speeds up response times for users. Cached data is regularly updated to ensure that users receive the most current information.

#### **5. Search Functionality**

- **Elasticsearch Integration**: When users perform a search, the Search Services query Elasticsearch, which is optimized for full-text search and high-speed querying.
- **Change Data Capture (CDC)**: To keep Elasticsearch in sync with the NoSQL database, a CDC process is used. This ensures that any changes in the NoSQL database (like new tweets) are quickly reflected in Elasticsearch, allowing users to find the most up-to-date results.

#### **6. Timeline and Notification Services**

- **Timeline Generation**: The Tweet Generation Service retrieves tweets from the relevant shards based on user activity and preferences. These tweets are then cached to improve the speed and efficiency of timeline updates.
- **Real-Time Notifications**: The Notification Services send alerts to users about new tweets or replies. This is managed through a Message Broker, which ensures reliable and asynchronous message delivery across the system. Notifications are generated and sent in real-time to keep users engaged.

#### **7. Replication and High Availability**

- **SQL and NoSQL Replication**: Both the SQL and NoSQL databases are replicated. For SQL, this includes creating read-only replicas to distribute the read load and ensure high availability. For NoSQL, replication ensures data redundancy and improves the system's resilience to failures.
- 

![0](/assets/img/2024-08-10, 5:40:00 am-[SystemDesign-Twritter]-System-flows.md/0.png)

