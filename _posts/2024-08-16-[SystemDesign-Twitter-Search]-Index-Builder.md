---
layout: post
date: 2024-08-16
title: "[SystemDesign-Twitter Search] Index Builder"
tags: [SystemDesign, Architecture, Twitter Search, ]
categories: [SystemDesign, Basics, ]
---


### **1. 인덱스 빌더(Index Builder)란?**


**인덱스 빌더**는 인덱스 서버가 데이터를 인덱싱하는 과정에서 그 데이터를 효율적으로 관리하고, 인덱스와 데이터 간의 매핑 정보를 생성하는 도구이다. 인덱스 빌더는 주로 다음과 같은 역할을 수행한다.


#### **2. 인덱스 빌더의 주요 역할**

1. **데이터와 인덱스 서버 간의 매핑 관리**:
	- 인덱스 빌더는 각 데이터 항목(예: 트윗, 문서, 제품 등)이 어느 인덱스 서버에 저장되어 있는지를 매핑한다.
	- 이 매핑 정보는 인덱스 서버가 장애로 인해 재구축이 필요할 때, 어떤 데이터를 복구해야 하는지 빠르게 파악할 수 있도록 돕는다.
2. **인덱스 생성 및 업데이트**:
	- 새로운 데이터가 추가되거나 기존 데이터가 수정될 때 인덱스를 생성하고 업데이트한다. 이 과정에서 인덱스 빌더는 데이터를 분석하여 검색 가능한 형태로 변환한다.
	- 예를 들어, 텍스트 데이터를 분석하여 키워드 기반의 인덱스를 생성하거나, 데이터를 필드별로 분류하여 효율적인 검색을 가능하게 한다.
3. **인덱스 서버의 재구축 지원**:
	- 인덱스 서버가 장애로 인해 복구해야 하는 경우, 인덱스 빌더는 해당 서버에 필요한 데이터 목록을 제공하여 인덱스를 재구축할 수 있도록 지원한다.
	- 이 과정에서 인덱스 빌더는 매핑된 데이터와 인덱스 서버 간의 관계를 빠르게 조회하고, 필요한 데이터를 정확하게 전달한다.
4. **빠른 인덱스 접근을 위한 해시테이블 관리**:
	- 인덱스 빌더는 인덱스 서버와 데이터 간의 매핑 정보를 해시테이블 형태로 관리하여 빠르게 접근할 수 있도록 한다.
	- 예를 들어, 인덱스 서버 번호를 키(key)로, 해당 서버에 저장된 데이터 ID 리스트를 값(value)으로 하는 해시테이블을 사용하여 효율적인 인덱스 관리를 수행한다.
5. **인덱스 서버로의 데이터 배포**:
	- 인덱스 빌더는 생성된 인덱스를 인덱스 서버로 배포하여, 실시간 검색 쿼리를 처리할 수 있게 한다.
	- 배포된 인덱스는 사용자가 쿼리를 보낼 때 빠르고 정확하게 데이터를 검색할 수 있도록 돕는다.
6. **내결함성을 위한 복제 관리**:
	- 인덱스 빌더 자체가 장애가 발생할 경우를 대비하여, 복제본을 유지한다. 이를 통해 하나의 인덱스 빌더에 문제가 생겨도 다른 복제본이 이를 대체하여 인덱스 생성과 관리를 지속할 수 있다.

#### **3. 인덱스 빌더의 작동 방식**

1. **해시 함수 기반 데이터 분배**:
	- 트위터의 경우, 각 트윗의 TweetID를 해시 함수에 입력하여 해시 값을 생성한다.
	- 이 해시 값에 따라 해당 트윗이 저장될 인덱스 서버가 결정된다. 예를 들어, 특정 해시 범위에 속하는 트윗은 특정 인덱스 서버에 저장되도록 분배된다.
2. **매핑 정보 저장**:
	- **인덱스 빌더**는 TweetID와 이를 저장하는 인덱스 서버 간의 매핑 정보를 관리한다. 즉, 해시 값을 기반으로 어느 서버에 어떤 트윗이 저장되어 있는지에 대한 정보를 저장한다.
	- 이러한 매핑 정보는 해시테이블과 같은 데이터 구조에 저장될 수 있다. 이 경우, TweetID는 인덱스 서버의 ID(또는 해시 범위)이고, TweetID는 그 서버에 저장된 TweetID 리스트(또는 해시 값 리스트)이다.
3. **서버별 데이터 관리**:
	- 인덱스 빌더는 각 인덱스 서버가 담당하는 데이터 범위를 명확하게 관리한다. 이로 인해, 인덱스 서버가 장애를 겪을 경우 인덱스 빌더가 해당 서버에 어떤 데이터가 있어야 하는지를 알려줄 수 있다.
	- 예를 들어, 인덱스 빌더는 "서버 A는 해시 값 1000~2000 범위의 TweetID를 저장한다"는 식으로 매핑 정보를 저장한다.
4. **인덱스 재구축 시 데이터 제공**:
	- 만약 특정 인덱스 서버가 장애로 인해 재구축이 필요하다면, 인덱스 빌더는 해당 서버가 관리해야 할 TweetID 목록을 제공하여, 필요한 데이터를 빠르게 가져올 수 있게 한다.
	- 이 정보는 데이터베이스에서 트윗을 조회하고, 인덱스를 다시 생성하는 데 사용된다.
5. **인덱스 빌더의 복제와 내결함성**:
	- 인덱스 빌더 자체가 단일 장애점이 되지 않도록 복제본을 유지한다. 이를 통해 인덱스 빌더가 장애를 겪더라도 다른 복제본이 계속해서 매핑 정보를 제공할 수 있다.
