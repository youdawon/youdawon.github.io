---
layout: post
date: 2024-08-19
title: "[SystemDesign-Facebook Newsfeed] API Flows"
tags: [System Design, Facebook Newsfeed, Architecture, ]
categories: [System Design, Problems, Facebook Newsfeed, ]
---


### **1. 로드 밸런싱 (Load Balancer/API Gateway)**

- **일관된 해싱(Consistent Hashing)**:
	- **목적**: `UserID`를 기반으로 트래픽을 고르게 분산시키기 위해 사용돼. 이 방식은 사용자가 동일한 서버로 라우팅되도록 하여 캐시 일관성을 유지하고, 트래픽을 효율적으로 분배하는 데 도움이 된다.
	- **장점**: 서버 간 부하 분산이 잘 이루어지며, 서버를 추가하거나 제거할 때 데이터 재분배를 최소화할 수 있다. 이는 특히 대규모 사용자가 동시에 접속하는 환경에서 중요하다.
	- **고려 사항**: 서버 성능이 균일하지 않거나 특정 서버에 과부하가 걸릴 경우, 가중치 기반 라운드 로빈(Weighted Round Robin) 또는 최소 연결(Least Connections)과 같은 대체 알고리즘을 추가로 고려해야 할 수 있다.

#### **2. 뉴스피드 스케줄러 (Newsfeed Scheduler)**

- **기능**: 사용자별로 최대 500개의 뉴스피드 게시물을 사전에 생성하여 캐시에 저장하는 역할을 한다. 이로 인해 사용자가 뉴스피드를 요청할 때 빠른 응답을 제공할 수 있다.
- **장점**: 사전 생성된 뉴스피드를 캐시에서 빠르게 제공할 수 있어, 사용자 경험을 개선할 수 있다.
- **고려 사항**:
	- **실시간 데이터 동기화**: 스케줄러가 캐시에 저장한 데이터와 실시간으로 생성되는 새로운 게시물 간의 일관성을 유지하는 것이 중요하다. 실시간 요청이 들어올 때 캐시가 최신 데이터를 제공할 수 있도록 동기화 메커니즘을 강화해야 한다.

#### **3. 캐시 관리 (Cache Management)**

- **캐시 구조**: Redis를 활용한 캐시가 도입되어 있으며, TTL(Time To Live), LRU(Least Recently Used), LFU(Least Frequently Used) 정책을 사용해 캐시 데이터를 관리하고 있다.
	- **TTL**: 데이터의 유효 기간을 설정해, 오래된 데이터를 자동으로 제거한다.
	- **LRU/LFU**: 자주 사용되지 않는 데이터를 자동으로 제거하여 캐시 효율성을 높인다.
- **장점**:
	- **고속 데이터 제공**: 캐시에 자주 조회되는 데이터를 저장함으로써 데이터베이스에 대한 요청을 줄이고, 더 빠른 응답 시간을 제공할 수 있다.
	- **효율적 메모리 사용**: LRU와 LFU 정책을 통해 자주 사용되지 않는 데이터를 제거하여 캐시 메모리를 효율적으로 사용할 수 있다.
- **고려 사항**:
	- **캐시 히트율 최적화**: 캐시의 히트율을 지속적으로 모니터링하여, 필요시 캐시 정책을 조정해 성능을 최적화해야 한다.
	- **캐시 무효화**: 실시간 데이터와의 동기화를 위해, 적절한 캐시 무효화 전략을 수립할 필요가 있다.

#### **4. 데이터베이스 및 캐시 연계 (Database and Cache Integration)**

- **역할 분담**:
	- **데이터베이스(SQL)**: 메타데이터와 같은 주요 데이터를 저장하며, 캐시에서 데이터가 없는 경우 데이터베이스에서 직접 데이터를 가져와 캐시에 로드한다.
	- **캐시**: 빠른 응답을 제공하기 위해 주로 사용되며, 데이터베이스의 부하를 줄이는 역할을 한다.
- **장점**:
	- **부하 감소**: 캐시를 통해 자주 조회되는 데이터는 데이터베이스 요청을 거치지 않으므로, 데이터베이스 부하가 줄어들고, 전체 시스템의 성능이 향상된다.
	- **빠른 데이터 접근**: 캐시가 대부분의 데이터를 처리함으로써 사용자 요청에 대한 응답 속도를 크게 단축할 수 있다.
- **고려 사항**:
	- **데이터 일관성**: 캐시와 데이터베이스 간의 데이터 일관성을 유지하기 위해 캐시 갱신 주기와 무효화 전략을 세심하게 관리해야 한다.

![0](/assets/img/2024-08-19-[SystemDesign-Facebook-Newsfeed]-API-Flows.md/0.png)

