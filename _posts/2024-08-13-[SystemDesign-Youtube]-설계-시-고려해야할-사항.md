---
layout: post
date: 2024-08-13
title: "[SystemDesign-Youtube] 설계 시 고려해야할 사항"
tags: [SystemDesign, Architecture, Youtube, ]
categories: [SystemDesign, Problems, Youtube, ]
---


### 1. 유투브의 썸네일은 어디에 저장되는 것이 좋을까?


Amazon S3는 일반적으로 YouTube 썸네일 저장에 적합한 선택이지만, 썸네일을 Google Bigtable에 저장하는 방법도 고려해볼 수 있다. 여기서 썸네일을 저장한다는 것은 썸네일의 URL이 아닌, 이미지 데이터를 직접 저장하는 것을 의미한다.

- **썸네일 저장 방식**:
	- 각 썸네일 이미지는 5KB 미만으로 가정할 때, Bigtable에 Base64로 인코딩된 이미지 데이터나 바이너리 형태로 저장할 수 있다.
	- 비디오 ID를 행(row)으로, 썸네일 데이터를 열(column)로 하여 저장하는 방식이다.
- **Bigtable이란?**:
	- Bigtable은 HBase에서 영감을 받아 설계된 분산형 NoSQL 데이터베이스로, Google 내부에서 대규모 데이터를 빠르게 저장하고 처리하기 위해 개발된 시스템이다.
	- 특히 대용량의 구조화된 데이터를 빠르게 읽고 쓰는 작업에 최적화되어 있다.

예시)



{% raw %}
```yaml
Row Key: video_id_12345
Columns:
- thumbnail_data: <Base64 encoded image data>
- other_metadata: <other related metadata>
```
{% endraw %}


- **장점**:
	- 이미지 데이터와 메타데이터를 동일한 데이터베이스에서 관리할 수 있어, 쿼리와 관리가 단순해진다.
- **단점**:
	- Bigtable은 대규모 텍스트 데이터를 처리하는 데 최적화되어 있기 때문에, 이미지와 같은 바이너리 데이터를 직접 저장하면 효율적이지 않을 수 있다. 특히 데이터 크기가 클 경우 성능에 영향을 줄 수 있다.

#### 2. 중복된 비디오를 업로드 시 어떻게 처리하면 좋을까?


비디오 파일은 이미지에 비해 크기가 크고, 길게는 24시간이 넘는 경우도 있어 동일한 비디오를 중복 업로드할 경우 여러 문제가 발생할 수 있다. 이러한 문제를 해결하기 위해 중복된 비디오를 효과적으로 처리하는 방법이 필요하다.


#### 중복된 비디오 업로드 시 발생할 수 있는 문제점:

- **데이터 저장소 낭비**:
	- 중복된 비디오를 여러 번 저장하면 불필요하게 저장소 공간이 낭비된다. 동일한 콘텐츠에 대해 여러 복사본을 유지하면 더 많은 저장 용량이 필요하게 되어, 비용과 자원의 낭비로 이어질 수 있다.
- **캐싱 효율성 저하**:
	- 캐시에 중복된 비디오가 존재할 경우, 캐시 공간이 중복된 콘텐츠로 채워져 실제로 고유한 콘텐츠를 저장할 공간이 줄어든다. 이로 인해 캐시 효율성이 떨어지고, 더 많은 캐시 미스(cache miss)가 발생할 수 있다.
- **네트워크 사용량 증가**:
	- 중복된 비디오를 네트워크를 통해 전송하게 되면, 네트워크 트래픽이 증가한다. 이는 네트워크 부하를 증가시키고, 네트워크 인프라에 추가적인 부담을 줄 수 있다.
- **에너지 소비 증가**:
	- 높은 저장소 사용량, 비효율적인 캐시 운영, 증가된 네트워크 트래픽은 모두 더 많은 에너지 소비로 이어질 수 있다. 이러한 비효율성들은 전반적인 시스템 에너지 효율을 저하시켜 불필요한 에너지 낭비를 초래할 수 있다.

#### 중복된 비디오를 처리하는 방법:

1. **해시 기반 중복 체크**:
	- 비디오의 고유 정보를 해시 값으로 변환한 후, 이를 데이터베이스에 저장한다. 이후 동일한 해시 값이 존재할 경우, 이미 존재하는 영상으로 간주하고 중복 업로드를 방지할 수 있다. 이 방법은 간단하면서도 효율적으로 중복된 비디오를 탐지할 수 있다.
2. **비디오 매칭 알고리즘 사용**:
	- **Block Matching**이나 **Phase Correlation**과 같은 비디오 매칭 알고리즘을 통해 중복된 영상을 감지할 수 있다. 이러한 알고리즘은 비디오 간의 유사성을 비교하여, 동일한 또는 유사한 콘텐츠를 식별하는 데 사용된다.
3. **부분 중복 처리**:
	- 만약 새로 등록한 영상이 이미 존재하는 영상의 일부라면, 영상을 작은 조각(chunk)으로 나눈 후 해당 부분만 추출하여 저장하는 방법도 있다. 이 방식은 중복된 부분을 최소화하고, 저장소 효율성을 높일 수 있다.

이러한 방법들을 통해 비디오 중복을 효과적으로 관리하고, 저장소 공간과 네트워크 자원의 낭비를 줄일 수 있다.

